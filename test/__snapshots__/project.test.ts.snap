// Jest Snapshot v1, https://jestjs.io/docs/snapshot-testing

exports[`snapshot 1`] = `
{
  ".gitattributes": "# ~~ Generated by projen. To modify, edit .projenrc.ts and run "npx projen".

* text=auto eol=lf",
  ".github/workflows/main.yml": "# ~~ Generated by projen. To modify, edit .projenrc.ts and run "npx projen".

name: main
on:
  push:
    branches:
      - main
jobs:
  discover:
    runs-on: ubuntu-latest
    permissions:
      contents: read
    outputs:
      stacks: \${{ steps.discover.outputs.stacks }}
    steps:
      - uses: actions/checkout@v6
      - uses: actions/setup-python@v5
        with:
          python-version: 3.x
      - name: Install dependencies
        run: uv sync
      - name: Discover stacks
        id: discover
        run: |-
          set -euo pipefail
          echo "Listing stacks..."
          ALL=$(pulumi stack ls --json | node -e "const fs=require('fs');const data=JSON.parse(fs.readFileSync(0,'utf8'));const names=data.map(s=>s.name);const filtered=names.filter(n=>n!=='dev');process.stdout.write(JSON.stringify(filtered));")
          echo "stacks=$ALL" >> $GITHUB_OUTPUT
        shell: bash
        working-directory: .
  test:
    needs: discover
    runs-on: ubuntu-latest
    permissions:
      contents: read
    steps:
      - uses: actions/checkout@v6
      - uses: actions/setup-python@v5
        with:
          python-version: 3.x
      - name: Install dependencies
        run: uv sync
      - name: "Pulumi up (test stack: dev)"
        uses: pulumi/actions@v6
        env:
          PULUMI_ACCESS_TOKEN: \${{ secrets.PULUMI_ACCESS_TOKEN }}
        with:
          command: up
          stack-name: dev
          work-dir: .
          github-token: \${{ secrets.GITHUB_TOKEN }}
          comment-on-pr: "false"
          yes: "true"
  deploy:
    needs:
      - discover
      - test
    runs-on: ubuntu-latest
    permissions:
      contents: read
    if: \${{ needs.discover.outputs.stacks != '[]' }}
    steps:
      - uses: actions/checkout@v6
      - uses: actions/setup-python@v5
        with:
          python-version: 3.x
      - name: Install dependencies
        run: uv sync
      - name: Pulumi up (matrix stack)
        uses: pulumi/actions@v6
        env:
          PULUMI_ACCESS_TOKEN: \${{ secrets.PULUMI_ACCESS_TOKEN }}
        with:
          command: up
          stack-name: \${{ matrix.stack }}
          work-dir: .
          github-token: \${{ secrets.GITHUB_TOKEN }}
          comment-on-pr: "false"
          yes: "true"
    strategy:
      matrix:
        stack: \${{ fromJSON(needs.discover.outputs.stacks) }}
",
  ".gitignore": "# ~~ Generated by projen. To modify, edit .projenrc.ts and run "npx projen".
node_modules/
!/.gitattributes
!/.projen/tasks.json
!/.projen/deps.json
!/.projen/files.json
!/tsconfig.projen.json
!/.github/workflows/main.yml
!/.projenrc.ts
",
  ".projen/files.json": {
    "//": "~~ Generated by projen. To modify, edit .projenrc.ts and run "npx projen".",
    "files": [
      ".gitattributes",
      ".github/workflows/main.yml",
      ".gitignore",
      ".projen/deps.json",
      ".projen/files.json",
      ".projen/tasks.json",
      "tsconfig.projen.json",
    ],
  },
  ".projen/tasks.json": {
    "//": "~~ Generated by projen. To modify, edit .projenrc.ts and run "npx projen".",
    "tasks": {
      "build": {
        "description": "Full release build",
        "name": "build",
        "steps": [
          {
            "spawn": "default",
          },
          {
            "spawn": "pre-compile",
          },
          {
            "spawn": "compile",
          },
          {
            "spawn": "post-compile",
          },
          {
            "spawn": "test",
          },
          {
            "spawn": "package",
          },
        ],
      },
      "compile": {
        "description": "Only compile",
        "name": "compile",
      },
      "default": {
        "description": "Synthesize project files",
        "name": "default",
        "steps": [
          {
            "exec": "npx -y ts-node --project tsconfig.projen.json .projenrc.ts",
          },
        ],
      },
      "eject": {
        "description": "Remove projen from the project",
        "env": {
          "PROJEN_EJECTING": "true",
        },
        "name": "eject",
        "steps": [
          {
            "spawn": "default",
          },
        ],
      },
      "package": {
        "description": "Creates the distribution package",
        "name": "package",
      },
      "post-compile": {
        "description": "Runs after successful compilation",
        "name": "post-compile",
      },
      "pre-compile": {
        "description": "Prepare the project for compilation",
        "name": "pre-compile",
      },
      "test": {
        "description": "Run tests",
        "name": "test",
      },
    },
  },
  "tsconfig.projen.json": {
    "compilerOptions": {},
    "exclude": [
      "node_modules",
    ],
    "include": [
      "**/*.ts",
      ".projenrc.ts",
      "projenrc/**/*.ts",
    ],
  },
}
`;
